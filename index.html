<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hyperspace Starfield</title>
  <style>
    body { margin:0; overflow:hidden; background:black; }
    canvas { display:block; }
  </style>
</head>
<body>
<canvas id="starfield"></canvas>
<script>
const canvas = document.getElementById("starfield");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = [];
let numStars = 400;
let speed = 0;
let charging = false;
let chargeStart = 0;
let aimY = canvas.height / 2;
let lastTouchY = null;

// initialize stars
for (let i = 0; i < numStars; i++) {
  stars.push({
    x: (Math.random() - 0.5) * canvas.width,
    y: (Math.random() - 0.5) * canvas.height,
    z: Math.random() * canvas.width
  });
}

function draw() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "white";
  for (let star of stars) {
    star.z -= speed;
    if (star.z <= 0) {
      star.x = (Math.random() - 0.5) * canvas.width;
      star.y = (Math.random() - 0.5) * canvas.height;
      star.z = canvas.width;
    }
    let k = 128.0 / star.z;
    let sx = star.x * k + canvas.width / 2;
    let sy = star.y * k + aimY;
    if (sx >= 0 && sx < canvas.width && sy >= 0 && sy < canvas.height) {
      let size = (1 - star.z / canvas.width) * 2;
      ctx.fillRect(sx, sy, size, size);
    }
  }
  requestAnimationFrame(draw);
}
draw();

// fire shot based on charge time
function fireShot(chargeTime) {
  speed = Math.min(chargeTime / 100, 40); // cap speed
  setTimeout(() => { speed = 0; }, 1000); // reset after 1s
}

// --- MOUSE CONTROLS ---
canvas.addEventListener("mousedown", e => {
  charging = true;
  chargeStart = Date.now();
});
canvas.addEventListener("mouseup", e => {
  charging = false;
  let chargeTime = Date.now() - chargeStart;
  fireShot(chargeTime);
});
canvas.addEventListener("mousemove", e => {
  aimY = e.clientY;
});

// --- TOUCH CONTROLS ---
canvas.addEventListener("touchstart", e => {
  charging = true;
  chargeStart = Date.now();
  lastTouchY = e.touches[0].clientY;
  e.preventDefault();
});

canvas.addEventListener("touchend", e => {
  charging = false;
  let chargeTime = Date.now() - chargeStart;
  fireShot(chargeTime);
  lastTouchY = null;
  e.preventDefault();
});

canvas.addEventListener("touchmove", e => {
  let touch = e.touches[0];
  let deltaY = touch.clientY - lastTouchY;
  if (Math.abs(deltaY) > 5) {
    if (deltaY < 0) {
      speed = Math.min(speed + 0.5, 80); // swipe up = faster
    } else {
      speed = Math.max(speed - 0.5, 1);  // swipe down = slower
    }
    lastTouchY = touch.clientY;
  }
  aimY = touch.clientY; // vertical position shifts starfield perspective
  e.preventDefault();
});

// resize handler
window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>
